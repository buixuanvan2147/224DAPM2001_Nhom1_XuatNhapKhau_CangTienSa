@{
    ViewBag.Title = "Index";
}
<style>
    /* Điều chỉnh cho màn hình nhỏ hơn (ví dụ: điện thoại di động) */
    @@media (max-width: 767.98px) {
        .jumbotron {
            padding-top: 3rem !important; /* Giảm padding trên cùng */
            padding-bottom: 3rem !important; /* Giảm padding dưới cùng */
        }

        .jumbotron h1 {
            font-size: 1.8rem; /* Giảm kích thước font cho tiêu đề chính */
            margin-bottom: 1rem !important; /* Giảm khoảng cách dưới tiêu đề */
        }

        .jumbotron h1.display-3 {
            font-size: 2.2rem; /* Giảm kích thước font cho tiêu đề lớn */
            margin-bottom: 2rem !important; /* Giảm khoảng cách dưới tiêu đề lớn */
        }

        .input-group {
            flex-direction: column; /* Đặt input và button trên hai hàng riêng biệt */
        }

        .input-group input[type="text"] {
            width: 100%; /* Chiếm toàn bộ chiều rộng */
            margin-bottom: 10px; /* Thêm khoảng cách dưới input */
            padding: 15px !important; /* Giảm padding cho input */
            text-align: center; /* Căn giữa text trong input */
        }

        .input-group-append {
            width: 100%; /* Chiếm toàn bộ chiều rộng */
        }

        .input-group-append button {
            width: 100%; /* Nút chiếm toàn bộ chiều rộng */
            padding: 12px 15px; /* Giảm padding cho nút */
        }

        .mx-auto {
            max-width: 90% !important; /* Giảm max-width của khối tìm kiếm */
        }

        .mt-3 small {
            font-size: 0.8rem; /* Giảm kích thước font cho text nhỏ */
        }
    }

    /* Điều chỉnh cho màn hình trung bình (ví dụ: máy tính bảng) */
    @@media (min-width: 768px) and (max-width: 991.98px) {
        .jumbotron h1.display-3 {
            font-size: 3rem; /* Điều chỉnh kích thước font cho màn hình trung bình */
        }

        .input-group input[type="text"] {
            padding: 25px !important; /* Điều chỉnh padding cho input */
        }

        .input-group-append button {
            padding: 25px 20px; /* Điều chỉnh padding cho button */
        }
    }
</style>
<div class="jumbotron jumbotron-fluid mb-5">
    <div class="container text-center py-5">
        <h1 class="text-primary mb-4">An Toàn & Nhanh Chóng</h1>
        <h1 class="text-white display-3 mb-5">Tra Cứu Thông Tin Đơn Hàng</h1>
        <div class="mx-auto" style="width: 100%; max-width: 600px;">
            <div class="input-group">
                <input type="text" id="maDonHang" class="form-control border-light" style="padding: 30px;" placeholder="Mã Đơn Hàng">
                <div class="input-group-append">
                    <button id="btnTraCuu" class="btn btn-primary px-3"> <i class="fas fa-search"></i> Tra Cứu </button>
                </div>
            </div>
        </div>
        <div class="mt-3">
            <small class="text-white-50">Vui lòng nhập mã đơn hàng của bạn để theo dõi.</small>
        </div>
    </div>
</div>

@section Scripts {
    <script type="text/javascript">
        $(document).ready(function () {
            console.log("jQuery đã sẵn sàng. Kiểm tra sự kiện click cho #btnTraCuu.");

            $("#btnTraCuu").click(function () {
                console.log("Nút Tra Cứu được nhấn.");

                var maDonHang = $("#maDonHang").val();
                console.log("Mã đơn hàng nhập vào: " + maDonHang);

                if (maDonHang.trim() === "") {
                    alert("Vui lòng nhập Mã Đơn Hàng.");
                    console.log("Mã đơn hàng rỗng.");
                    return;
                }

                if (!/^[a-zA-Z0-9-]+$/.test(maDonHang)) {
                    alert("Mã đơn hàng chỉ chứa chữ cái, số và dấu gạch ngang.");
                    console.log("Mã đơn hàng không hợp lệ: " + maDonHang);
                    return;
                }

                var urlTraCuu = '@Url.Action("TraCuuDonHang", "Home")';
                console.log("URL TraCuuDonHang: " + urlTraCuu);

                $.ajax({
                    url: urlTraCuu,
                    type: 'POST',
                    data: { maDonHang: maDonHang },
                    dataType: 'json',
                    success: function (data) {
                        console.log("Phản hồi từ server:", data);
                        if (data.Success) {
                            if (data.MaDonHang) {
                                // Chuyển hướng đến action ChiTietDonHang của khách hàng
                                var redirectUrl = '@Url.Action("XemChiTietDonHang", "KhachHang")?maDonHang=' + encodeURIComponent(data.MaDonHang);
                                console.log("Chuyển hướng đến: " + redirectUrl);
                                window.location.href = redirectUrl;
                            } else {
                                console.error("MaDonHang không có giá trị trong phản hồi.");
                                alert("Lỗi: Không tìm thấy mã đơn hàng trong phản hồi từ server.");
                            }
                        } else {
                            alert(data.Message || "Không tìm thấy đơn hàng.");
                            console.log("Tra cứu thất bại: " + (data.Message || "Không có thông báo lỗi."));
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error("Lỗi AJAX:", status, error);
                        console.error("Phản hồi từ server:", xhr.responseText);
                        alert("Đã có lỗi xảy ra trong quá trình tra cứu: " + (xhr.responseText || error));
                    }
                });
            });
        });
    </script>
}