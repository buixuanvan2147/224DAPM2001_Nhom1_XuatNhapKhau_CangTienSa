@{
    ViewBag.Title = "Đăng ký gửi hàng";
    Layout = "~/Views/Shared/_LayoutKhachHang.cshtml";
}

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <title>Tien Sa E-PORT - Đăng ký gửi hàng</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="~/Content/css/style.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            // Ẩn dropdown hàng hóa xuất khẩu ban đầu
            $('#maHangHoaDiv').hide();

            // Điều chỉnh kích thước danh mục hàng hóa ban đầu
            $('#maDanhMucHangHoaDiv').removeClass('col-md-4').addClass('col-md-4');

            // Khi thay đổi danh mục hàng hóa
            $('#maDanhMucHangHoa').change(function () {
                var maDanhMuc = $(this).val();
                if (maDanhMuc) {
                    // Thu nhỏ danh mục hàng hóa và hiển thị hàng hóa xuất/nhập khẩu
                    $('#maDanhMucHangHoaDiv').removeClass('col-md-4').addClass('col-md-2');
                    $('#maHangHoaDiv').removeClass('col-md-4').addClass('col-md-2').show();

                    // Gọi AJAX để lấy danh sách hàng hóa theo danh mục
                    $.ajax({
                        url: '@Url.Action("GetHangHoaByDanhMuc", "KhachHang")',
                        type: 'GET',
                        data: { maDanhMucHangHoa: maDanhMuc },
                        success: function (data) {
                            // Xóa các option hiện tại trong dropdown hàng hóa
                            $('#maHangHoa').empty();
                            $('#maHangHoa').append('<option value="">-- Chọn hàng hóa --</option>');

                            // Thêm các hàng hóa tương ứng
                            $.each(data, function (index, item) {
                                $('#maHangHoa').append('<option value="' + item.Value + '">' + item.Text + '</option>');
                            });
                        },
                        error: function () {
                            alert('Không thể tải danh sách hàng hóa. Vui lòng thử lại.');
                            $('#maHangHoaDiv').hide();
                            $('#maDanhMucHangHoaDiv').removeClass('col-md-2').addClass('col-md-4');
                        }
                    });
                } else {
                    // Ẩn dropdown hàng hóa và khôi phục kích thước danh mục
                    $('#maHangHoaDiv').hide();
                    $('#maDanhMucHangHoaDiv').removeClass('col-md-2').addClass('col-md-4');
                    $('#maHangHoa').empty();
                    $('#maHangHoa').append('<option value="">-- Chọn hàng hóa --</option>');
                }
            });

            // Khi thay đổi đơn vị tính
            $('#DonViTinhKhoiLuong').change(function () {
                var selectedUnit = $(this).val();
                $('#KhoiLuongDiv').hide();
                $('#SoLuongDiv').hide();

                if (selectedUnit === 'Tấn') { // Đổi từ 'ton' thành 'Tấn'
                    $('#KhoiLuongDiv').show();
                    $('#KhoiLuongLabel').text('Khối lượng (Tấn)');
                } else if (selectedUnit === 'Cái') { // Đổi từ 'cai' thành 'Cái'
                    $('#SoLuongDiv').show();
                    $('#SoLuongLabel').text('Số lượng (Cái)');
                }
            });

            // Khi thay đổi thời gian lưu kho
            $('#ThoiGianLuuKho').change(function () {
                var selectedTime = $(this).val();
                $('#ThoiGianLuuKhoKhacDiv').toggle(selectedTime === 'other');
            });

            // Khởi tạo trạng thái ban đầu
            $('#DonViTinhKhoiLuong').trigger('change');
            $('#ThoiGianLuuKho').trigger('change');
            $('#maDanhMucHangHoa').trigger('change');
        });
    </script>
</head>
<body>
    <header class="fixed-header">
        <!-- (header markup copied from template #1) -->
    </header>

    <main class="dashboard-container" style="padding-top: 10px;">
        <div class="main-content">
            <h2>Đăng ký gửi hàng</h2>
            @if (TempData["Error"] != null)
            {
                <div class="alert alert-danger">@TempData["Error"]</div>
            }
            @if (TempData["Success"] != null)
            {
                <div class="alert alert-success">@TempData["Success"]</div>
            }
            <form method="post" action="@Url.Action("TaoDonHang", "KhachHang")">
                <!-- Tên KH + Tên công ty + Mã số thuế -->
                <div class="form-row">
                    <div class="form-group col-md-4">
                        <label for="TenKhachHang">Tên khách hàng</label>
                        <input type="text" id="TenKhachHang" name="TenKhachHang" class="form-control" value="@ViewBag.TenKhachHang" readonly />
                    </div>
                    <div class="form-group col-md-4">
                        <label for="TenCongTy">Tên công ty</label>
                        <input type="text" id="TenCongTy" name="TenCongTy" class="form-control" value="@ViewBag.TenCongTy" readonly />
                    </div>
                    <div class="form-group col-md-4">
                        <label for="MaSoThue">Mã số thuế công ty</label>
                        <input type="text" id="MaSoThue" name="MaSoThue" class="form-control" value="@ViewBag.MaSoThue" readonly />
                    </div>
                </div>

                <!-- Ngày gửi + Tên người nhận + SĐT người nhận -->
                <div class="form-row">
                    <div class="form-group col-md-4">
                        <label for="NgayGui">Ngày gửi</label>
                        <input type="text" id="NgayGui" name="NgayGui" class="form-control" value="@DateTime.Now.ToString("yyyy-MM-dd")" readonly />
                    </div>
                    <div class="form-group col-md-4">
                        <label for="TenNguoiNhan">Tên người nhận</label>
                        <input type="text" id="TenNguoiNhan" name="TenNguoiNhan" class="form-control" required />
                    </div>
                    <div class="form-group col-md-4">
                        <label for="SDTNguoiNhan">Số điện thoại người nhận</label>
                        <input type="text" id="SDTNguoiNhan" name="SDTNguoiNhan" class="form-control" required />
                    </div>
                </div>

                <!-- Cảng đích đến + Loại hàng + Đơn vị tính + Khối lượng/Số lượng -->
                <div class="form-row">
                    <div class="form-group col-md-4">
                        <label for="CangDichDen">Cảng đích đến</label>
                        <select id="CangDichDen" name="CangDichDen" class="form-control" required>
                            <option value="">-- Chọn cảng --</option>
                            <option value="Cảng Đình Vũ">Cảng Đình Vũ</option>
                            <option value="Cảng Cát Lái">Cảng Cát Lái</option>
                            <option value="Cảng Hải Phòng">Cảng Hải Phòng</option>
                            <option value="Cảng Sài Gòn">Cảng Sài Gòn</option>
                            <option value="Cảng Singapore">Cảng Singapore</option>
                            <option value="Cảng Shanghai">Cảng Shanghai</option>
                            <option value="Cảng Tokyo">Cảng Tokyo</option>
                            <option value="Cảng Busan">Cảng Busan</option>
                            <option value="Cảng Hong Kong">Cảng Hong Kong</option>
                            <option value="Cảng Kaohsiung">Cảng Kaohsiung</option>
                            <option value="Cảng Los Angeles">Cảng Los Angeles</option>
                            <option value="Cảng Rotterdam">Cảng Rotterdam</option>
                            <option value="Cảng Hamburg">Cảng Hamburg</option>
                            <option value="Cảng Dubai">Cảng Dubai</option>
                        </select>
                    </div>
                    <div class="form-group col-md-4">
                        <label for="LoaiHang">Loại hàng</label>
                        <select id="LoaiHang" name="LoaiHang" class="form-control" required>
                            <option value="Cao Cấp">Cao cấp</option>
                            <option value="Dễ vỡ">Dễ vỡ</option>
                            <option value="Tốt">Tốt</option>
                            <option value="Trung bình">Trung bình</option>
                        </select>
                    </div>
                    <div class="form-group col-md-4">
                        <div style="display: flex; gap: 10px;">
                            <div style="flex: 1;">
                                <label for="DonViTinhKhoiLuong">Đơn vị tính</label>
                                <select id="DonViTinhKhoiLuong" name="DonViTinhKhoiLuong" class="form-control" required>
                                    <option value="Tấn">Tấn</option>
                                    <option value="Cái">Cái</option>
                                </select>
                            </div>
                            <div style="flex: 1;">
                                <div id="KhoiLuongDiv" style="display:none;">
                                    <label id="KhoiLuongLabel" for="KhoiLuong">Khối lượng (Tấn)</label>
                                    <input type="number" id="KhoiLuong" name="KhoiLuong" class="form-control" min="0" step="0.01" />
                                </div>
                                <div id="SoLuongDiv" style="display:none;">
                                    <label id="SoLuongLabel" for="SoLuong">Số lượng (Cái)</label>
                                    <input type="number" id="SoLuong" name="SoLuong" class="form-control" min="0" step="1" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Thời gian lưu kho + Danh mục hàng hóa + Hàng hóa xuất/nhập khẩu + Loại đơn hàng -->
                <div class="form-row">
                    <div class="form-group col-md-4">
                        <label for="ThoiGianLuuKho">Thời gian lưu kho tối đa (ngày)</label>
                        <div style="display: flex; gap: 10px;">
                            <select id="ThoiGianLuuKho" name="ThoiGianLuuKho" class="form-control" style="flex: 1;" required>
                                <option value="5">5 ngày</option>
                                <option value="10">10 ngày</option>
                                <option value="15">15 ngày</option>
                                <option value="20">20 ngày</option>
                                <option value="25">25 ngày</option>
                                <option value="30">30 ngày</option>
                                <option value="other">Khác</option>
                            </select>
                            <div id="ThoiGianLuuKhoKhacDiv" style="display: none; flex: 1;">
                                <input type="number" id="ThoiGianLuuKhoKhac" name="ThoiGianLuuKhoKhac" class="form-control" placeholder="Số ngày" min="1" step="1" />
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-md-4" id="maDanhMucHangHoaDiv">
                        <label for="maDanhMucHangHoa">Danh mục hàng hóa</label>
                        @Html.DropDownList("maDanhMucHangHoa", ViewBag.DanhMucHangHoaList as List<SelectListItem>, "-- Danh mục --", new { @class = "form-control", @required = "required" })
                    </div>
                    <div class="form-group col-md-4" id="maHangHoaDiv">
                        <label for="maHangHoa">Hàng hóa xuất/nhập khẩu</label>
                        <select id="maHangHoa" name="maHangHoa" class="form-control" required>
                            <option value="">-- Chọn hàng hóa --</option>
                        </select>
                    </div>
                    <div class="form-group col-md-4">
                        <label for="LoaiDonHang">Loại đơn hàng</label>
                        <select id="LoaiDonHang" name="LoaiDonHang" class="form-control" required>
                            <option value="">-- Loại đơn hàng --</option>
                            @foreach (var item in ViewBag.LoaiDonHangList as List<SelectListItem>)
                            {
                                <option value="@item.Value">@item.Text</option>
                            }
                        </select>
                    </div>
                </div>

                <!-- Mô tả -->
                <div class="form-row">
                    <div class="form-group col-md-12">
                        <label for="MoTa">Mô tả</label>
                        <textarea id="MoTa" name="MoTa" class="form-control" rows="4" placeholder="Nhập mô tả bổ sung cho đơn hàng..."></textarea>
                    </div>
                </div>

                <!-- Nút Gửi -->
                <div class="form-row">
                    <div class="form-group col-md-12">
                        <button type="submit" class="btn btn-primary" style="margin-bottom: 90px;">Gửi</button>
                    </div>
                </div>
            </form>
        </div>
    </main>
</body>
</html>